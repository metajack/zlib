CC = gcc
CFLAGS = -D_LARGEFILE64_SOURCE=1 -DHAVE_STDDEF_H -DHAVE_STDINT_H -DHAVE_SYS_TYPES_H

ZLIB_SRCS = adler32.c compress.c crc32.c deflate.c gzclose.c gzlib.c gzread.c gzwrite.c inflate.c infback.c inftrees.c inffast.c trees.c uncompr.c zutil.c

ifeq (@(PLATFORM),win32)
  ZLIB_SRCS += contrib/masmx86/inffas32.asm contrib/masmx86/match686.asm
  CFLAGS += -DASMV -DASMINF
else
  ZLIB_SRCS += contrib/asm686/match.S
  CFLAGS += -DASMV
endif

: foreach $(ZLIB_SRCS) |> $(CC) $(CFLAGS) -o %o -c %f |> %B.o
: *.o |> ar crs %o %f |> libz.a
